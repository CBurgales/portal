<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>Canigó. Como utilizar Google error-prone</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"Canigó. Como utilizar Google error-prone\" />");
		document.write("<meta name=\"description\" content=\"Como utilizar Google error-prone para evaluación estática de código en tiempo de compilación\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/drafts">
											



























										</a>
										

































































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	Canigó. Como utilizar Google error-prone


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 02-01-2021
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="introducción">Introducción</h2>

<p>El objetivo de este artículo es mostrar el uso de un complemento al compilador Java (javac) que permite la evaluación estática de código en tiempo de compilación. Este complemento es el proyecto: <a href="https://errorprone.info/">Google error-prone</a> que tiene su repositorio: <a href="https://github.com/google/error-prone">GIT</a></p>

<hr />

<h2 id="justificación">Justificación</h2>

<p><em>Error Prone</em> permite que el compilador de Java sea más poderoso al analizar el código fuente durante la compilación.</p>

<p>Algunas de las ventajas de utilizar este complemento:</p>

<ul>
<li><em>Shift left testing</em>: Muestra los errores que se descubren al principio del ciclo de vida del desarrollo de software. En lugar de identificarse durante la revisión del código o en la producción, ahora se identifican en el momento de la compilación. Se capturan antes de que le cuesten su tiempo.</li>
<li><em>Neutral al sistema de construcción</em>: Google Error Prone es un procesador de anotaciones Java que está conectado al compilador. Por tanto, se puede utilizar en cualquier sistema de construcción, por ejemplo, Bazel, Maven, Gradle, Ant.</li>
<li><em>Sugerencias de solución</em>: La solución del problema generalmente se sugiere al mismo tiempo que se identifica el error.</li>
</ul>

<hr />

<h2 id="configuración">Configuración</h2>

<p>Para poder utilizar el complemento en Canigó, es necesario modificar el archivo <code>pom.xml</code> que contiene la configuración maven del proyecto.</p>

<blockquote>
<p>Se recomienda utilizar JDK 8 o superior aunque es posible configurarlos para JDK 6 o 7.</p>
</blockquote>

<h3 id="cambios-en-el-archivo-pom-xml">Cambios en el archivo <code>pom.xml</code></h3>

<blockquote>
<p>Dentro del plugin <code>maven-compiler-plugin</code> que ya está configurado en los proyectos generados con <a href="https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/">Canigó plugin</a> se deben agregar las etiquetas: <code>&lt;compilerArgs&gt;</code> y <code>&lt;annotationProcessorPaths&gt;</code></p>
</blockquote>

<ul>
<li>Modificar plugin</li>
</ul>

<pre><code class="language-xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;source&gt;${maven.compiler.plugin.source}&lt;/source&gt;
    &lt;target&gt;${maven.compiler.plugin.target}&lt;/target&gt;
    &lt;compilerArgs&gt;
      &lt;arg&gt;-XDcompilePolicy=simple&lt;/arg&gt;
      &lt;arg&gt;-Xplugin:ErrorProne&lt;/arg&gt;
    &lt;/compilerArgs&gt;
    &lt;annotationProcessorPaths&gt;
      &lt;path&gt;
        &lt;groupId&gt;com.google.errorprone&lt;/groupId&gt;
        &lt;artifactId&gt;error_prone_core&lt;/artifactId&gt;
        &lt;version&gt;2.4.0&lt;/version&gt;
      &lt;/path&gt;&gt;
    &lt;/annotationProcessorPaths&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>

<blockquote>
<p>Sí se utiliza JDK 8, tambien es necesario cambiar el compilador de Java para utilizar una versión específica: <a href="github.com/google/error-prone-javac">javac</a></p>
</blockquote>

<ul>
<li>Agregar la versión del compilador en la sección de propiedades ya existente.</li>
</ul>

<pre><code class="language-xml">&lt;properties&gt;
  &lt;javac.version&gt;9+181-r4173-1&lt;/javac.version&gt;
&lt;/properties&gt;
</code></pre>

<ul>
<li>Agregar un perfil</li>
</ul>

<pre><code class="language-xml">  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;jdk8&lt;/id&gt;
      &lt;activation&gt;
        &lt;jdk&gt;1.8&lt;/jdk&gt;
      &lt;/activation&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
              &lt;fork&gt;true&lt;/fork&gt;
              &lt;compilerArgs combine.children=&quot;append&quot;&gt;
                &lt;arg&gt;-J-Xbootclasspath/p:${settings.localRepository}/com/google/errorprone/javac/${javac.version}/javac-${javac.version}.jar&lt;/arg&gt;
              &lt;/compilerArgs&gt;
            &lt;/configuration&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
</code></pre>

<blockquote>
<p>Mas información: <a href="https://errorprone.info/docs/installation">Instalación Google error-prone</a></p>
</blockquote>

<hr />

<h2 id="uso">Uso</h2>

<p>Al compilar con maven: <code>mvn compile</code>, a través de CLI o de un entorno de desarrollo, el complemento <strong>errror-prone</strong> va a realizar un análisis estático del proyecto como parte del proceso. En el caso de encontrar bugs clasificados como <em>Error por Defecto</em> se detendrá la compilación. En el caso de bugs clasificados como <em>Warning por defecto</em> no se detendrá la compilación. En ambos casos se mostrará el detalle del error y alguna propuesta de solución.</p>

<p>El detalle de los patrones de errores que se validarán al compilar se describen aqui: <a href="https://errorprone.info/bugpatterns">Patrones de errores</a></p>

<h3 id="ejemplo-con-cli">Ejemplo con CLI</h3>

<p>Se agrega un código con bug</p>

<pre><code class="language-java">  System.out.println(String.class.getClass().toString())
</code></pre>

<h4 id="ejecución">Ejecución:</h4>

<pre><code class="language-sh">mvn clean compile
</code></pre>

<h4 id="resultado">Resultado:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_cli_example1.gif" alt="CLI Ejemplo" /></p>

<h3 id="ejemplo-con-eclipse">Ejemplo con Eclipse</h3>

<p>error-prone puede utilizarse con plugins de Intellij y Eclipse.</p>

<p>Para utilizar en Eclipse es necesario tener el plugin: `` configurado</p>

<h4 id="configuración-1">Configuración:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_ide_conf.gif" alt="Eclipse Configuración" /></p>

<h4 id="resultado-1">Resultado:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_ide_example.gif" alt="Eclipse Ejemplo" /></p>

<p>Es posible excluir algunas de las advertencias de los patrones de errores para evitar que se detenga la compilación.</p>

<h3 id="ejemplo-de-exclusión">Ejemplo de exclusión</h3>

<p>Se excluye el error <em>GetClassOnClass</em> de la validación.</p>

<pre><code class="language-xml">  &lt;arg&gt;-Xplugin:ErrorProne -Xep:GetClassOnClass:OFF&lt;/arg&gt;
</code></pre>

<h4 id="resultado-2">Resultado:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_cli_exclusion.gif" alt="CLI Exclusion" /></p>

<h3 id="ejemplo-con-intellij-idea">Ejemplo con Intellij Idea</h3>

<h4 id="configuración-2">Configuración:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_ide_conf2.gif" alt="Intellij Configuración" /></p>

<h4 id="resultado-3">Resultado:</h4>

<p><img src="/images/howtos/2021-01-02_error_prone_ide_example2.gif" alt="Intellij Ejemplo" /></p>

<hr />

<h2 id="conclusión">Conclusión</h2>

<ul>
<li>El uso de este complemento permite mejorar la calidad del software bajo la premisa de encontrar errores lo mas rápido posible en el ciclo de vida del desarrollo.</li>
</ul>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
