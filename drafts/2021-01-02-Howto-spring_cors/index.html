<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>Canigó. Como permitir el intercambio cruzado de recursos (CORS)</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"Canigó. Como permitir el intercambio cruzado de recursos (CORS)\" />");
		document.write("<meta name=\"description\" content=\"Como permitir el intercambio cruzado de recursos (CORS) desde un servidor, en un origen distinto (dominio) al que pertenece.\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/drafts">
											



























										</a>
										

































































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	Canigó. Como permitir el intercambio cruzado de recursos (CORS)


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 02-01-2021
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="introducción">Introducción</h2>

<p>El objetivo de este artículo es mostrar como permitir el intercambio cruzado de recursos (<a href="https://www.w3.org/wiki/CORS_Enabled">CORS</a>) desde un servidor, en un origen distinto (dominio) al que pertenece, dentro de un proyecto generado con el framework Canigó</p>

<hr />

<h2 id="justificación">Justificación</h2>

<p>CORS es un mecanismo que restringue el acceso web a recursos fuera del dominio al que pertenece quien hace una petición, es decir, sí desde un navegador web se realiza una petición a un servidor y se requiere algún recurso web que este en otro servidor, entonces se utiliza CORS para su gestión.</p>

<p>CORS define como interactua un navegador web con un servidor para determinar si el intercambio de recursos con otros servidores es seguro. Para su funcionamiento CORS utiliza las cabeceras HTTP.</p>

<p>Cuando se utiliza un proyecto creado con <a href="https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/">Canigó plugin</a> que se basa en Spring, por defecto no se envian en la cabcera HTTP ninguno de los parámetros que permiten el intercambio cruzado; por lo que es necesario realizar algunos ajustes para su activación.</p>

<hr />

<h2 id="configuración">Configuración</h2>

<p>Para activar CORS en un proyecto creado con <a href="https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/">Canigó plugin</a>, se requiere crear un filtro web de Spring, agregarlo al contenedor de Spring y a la configuración del adaptador de seguridad de Spring.</p>

<h3 id="cambios-en-websecurityconfig-java">Cambios en <code>WebSecurityConfig.java</code></h3>

<pre><code class="language-java">@Configuration
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  ...

  @Override
  protected void configure(final HttpSecurity http) throws Exception {
    http.cors();
    ...
  }

  @Bean
  public CorsFilter corsFilter() {
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    CorsConfiguration config = new CorsConfiguration();
    config.setAllowCredentials(true);
    config.setAllowedOrigins(Collections.singletonList(CorsConfiguration.ALL));
    config.addAllowedHeader(CorsConfiguration.ALL);
    config.setAllowedMethods(Arrays.asList(CorsConfiguration.ALL));
    source.registerCorsConfiguration(&quot;/**&quot;, config);
    return new CorsFilter(source);
  }
  ...
}
</code></pre>

<hr />

<h2 id="uso">Uso</h2>

<h3 id="desarrollo">Desarrollo</h3>

<blockquote>
<p>Se requiere crear dentro de un proyecto creado con <a href="https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/">Canigó plugin</a> con el módulo de seguridad instalado, una pagina HTML que invoque a través de Javascript algún recurso del servidor utilizando las APIs <code>XMLHttpRequest</code> o  <code>Fetch</code>.</p>

<p>Ejemplo de página web que invoca el servicio REST <code>/equipaments/id</code> de prueba que existe en Canigó: <code>cors_test.html</code></p>
</blockquote>

<pre><code class="language-html">&lt;!DOCTYPE html PUBLIC&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
    &lt;meta http-equiv=&quot;encoding&quot; content=&quot;utf-8&quot; /&gt;
    &lt;title&gt;CORS Test&lt;/title&gt;
    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/cors_request.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div&gt;
      &lt;p class=&quot;equipament-id&quot;&gt;ID: &lt;/p&gt;
      &lt;p class=&quot;equipament-nom&quot;&gt;Nom: &lt;/p&gt;
      &lt;p class=&quot;equipament-municipi&quot;&gt;Municipi: &lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<pre><code class="language-javascript">$(document).ready(function() {
  $.ajax({
    url: &quot;http://localhost:8090/equipaments/15&quot;
  }).then(function(data, status, jqxhr) {
    $('.equipament-id').append(data.id);
    $('.equipament-nom').append(data.nom);
    $('.equipament-municipi').append(data.municipi);
    console.log(jqxhr);
  });
});
</code></pre>

<hr />

<h3 id="pruebas">Pruebas</h3>

<blockquote>
<p>Para probar el funcionamiento se inician 2 instancias de la aplicación utilizando puertos diferentes, en este caso se utilizan los puertos 8090 (donde se encuentra el servicio REST a consultar) y 8095 (donde se llamará la página Web)</p>
</blockquote>

<pre><code class="language-sh">  mvn spring-boot:run \
    -Dspring-boot.run.arguments=--server.port=8090
</code></pre>

<pre><code class="language-sh">  mvn spring-boot:run \
    -Dspring-boot.run.arguments=--server.port=8095 \
    -Dspring-boot.run.fork=false
</code></pre>

<hr />

<blockquote>
<p>Prueba con CORS desactivado</p>
</blockquote>

<ul>
<li>Se realiza la prueba sin configurar el filtro</li>
</ul>

<blockquote>
<p>Se observa que el navegador genera la petición correctamente para la aplicación que está en el puerto 8090, sin embargo, genera un error en la aplicación que está en el puerto 8095, que indica que no está permitido el intercambio</p>
</blockquote>

<p><img src="/images/howtos/2021-01-02_spring_cors_example1.png" alt="Spring CORS Ejemplo 1" /></p>

<p><img src="/images/howtos/2021-01-02_spring_cors_example2.png" alt="Spring CORS Ejemplo 2" /></p>

<hr />

<blockquote>
<p>Prueba con CORS activado</p>
</blockquote>

<ul>
<li>Se realiza la prueba con la configuración</li>
</ul>

<blockquote>
<p>Se observa que el navegador permite el intercambio y responde con los datos del servicio REST de prueba</p>
</blockquote>

<p><img src="/images/howtos/2021-01-02_spring_cors_example3.png" alt="Spring CORS Ejemplo 3" /></p>

<p><img src="/images/howtos/2021-01-02_spring_cors_example4.png" alt="Spring CORS Ejemplo 4" /></p>

<hr />

<h2 id="conclusión">Conclusión</h2>

<ul>
<li>Implementar el intercambio cruzado de recursos utilizando Canigó y Spring es posible y sencillo.</li>
</ul>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
